sudo: required
services:
  - docker
language: node_js
node_js:
  - 7

cache:
  directories:
    - $HOME/.yarn-cache

env:
  - SIDE=server
  - SIDE=app

before_install:
  - npm install -g yarn

install:
  - yarn install

script:
  - if [[ "$SIDE" == "server" ]]; then npm run server-lint; fi
  - if [[ "$SIDE" == "server" ]]; then npm run server-test; fi
  - if [[ "$SIDE" == "server" ]]; then npm run server-build; fi
  - if [[ "$SIDE" == "app" ]]; then npm run app-build; fi

after_success:
  - if [[ "$SIDE" == "server" ]]; then ./node_modules/.bin/nyc report --reporter=text-lcov | ./node_modules/.bin/coveralls; fi
  - >
    if [[ "$SIDE" == "server" ]]; then
      docker run --rm --privileged multiarch/qemu-user-static:register --reset
      travis_wait 60 docker build -t homiedashboard/armhf -f Dockerfile.armhf .
    fi
